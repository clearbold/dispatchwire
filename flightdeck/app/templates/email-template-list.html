{% extends "_layouts/base.html" %}
{% block content %}
<h2>Email Templates</h2>
    <ul>
{% for item in file_tree %}
        <li class="{{ item.item_cycle }} {{ item.item_type }} {{ item.item_level }}">
            {{ item.item_name }}{% if item.item_type=='file' %} <span class="timestamp">Last build: {{ item.item_last_build }}</span> <a href="{{ item.item_preview_link }}" target="_blank" class="preview-link">Preview</a><a href="#" class="build-link" data-template-name="{{ item.item_template_name }}"> {% if item.item_test == 'true' %}Build &amp; Test{% else %}Build{% endif %}</a>{% endif %}
        </li>
{% endfor %}
    </ul>
    <script type="text/javascript" src="/tmp-ui/jquery.js"></script>
    <script type="text/javascript">
        $('a.build-link').on('click', function(e) {
            e.preventDefault();

            $(this).addClass('build-pending');

            $.ajax({
                url: "/build/" + $(this).data('template-name'),
                context: $(this)
            }).done(function(data) {
                $(this).removeClass('build-pending');
                $(this).addClass('build-successful');
                $(this).prev().prev('span.timestamp').text('Last build: ' + data.lastBuild);
            });
        })
    </script>
{% endblock content %}